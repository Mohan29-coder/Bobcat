// ...existing code...
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - USDT Staking</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* small table tweaks to align recent transactions properly */
        
        #recentTxn {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
        }
        
        #recentTxn th,
        #recentTxn td {
            padding: 10px 8px;
            border-bottom: 1px solid #eee;
            vertical-align: middle;
        }
        
        #recentTxn th {
            background: #f7fbff;
            color: #007bff;
            text-align: left;
            font-weight: 600;
        }
        /* numeric alignment */
        
        .tx-amount {
            text-align: right;
            font-weight: 700;
            color: #111;
        }
        
        .tx-status {
            text-align: center;
            white-space: nowrap;
        }
        
        .tx-date {
            text-align: left;
            color: #555;
            white-space: nowrap;
        }
        
        .tx-meta {
            font-size: 12px;
            color: #666;
            word-break: break-all;
        }
        
        .no-data {
            color: #666;
            text-align: center;
        }
    </style>
</head>

<body>

    <!-- Sidebar -->
    <div class="sidebar">
        <h2>USDT <span>Stake</span></h2>
        <ul>
            <li><a href="dashboard.html" class="active">üè† Dashboard</a></li>
            <li><a href="wallet.html">üí∞ Wallet</a></li>
            <li><a href="staking.html">üìà Staking Plans</a></li>
            <li><a href="affiliate.html">ü§ù Affiliate</a></li>
            <li><a href="login.html" class="logout">üö™ Logout</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <header>
            <h1>Dashboard</h1>
            <p>Welcome to your staking dashboard. Manage and monitor your USDT earnings.</p>
        </header>

        <!-- Account Balance / Actions -->
        <section class="card">
            <h2>Available Balance</h2>
            <h1 id="availableBalance" style="color:#007bff;">$0.00</h1>
            <div style="display:flex; gap:10px; margin-top:12px;">
                <button onclick="window.location.href='wallet.html?mode=deposit'">Deposit</button>
                <button onclick="window.location.href='wallet.html?mode=withdraw'">Withdraw</button>
            </div>
        </section>

        <!-- Quick Actions -->
        <section class="card">
            <h2>Quick Actions</h2>
            <div class="action-buttons" style="display:flex; gap:15px; flex-wrap:wrap;">
                <button onclick="window.location.href='staking.html'">Start New Stake</button>
                <button onclick="window.location.href='affiliate.html'">Check Referrals</button>
            </div>
        </section>

        <!-- Recent Transactions -->
        <section class="card">
            <h2>Recent Transactions</h2>
            <table id="recentTxn">
                <thead>
                    <tr>
                        <th>Type</th>
                        <th class="tx-amount">Amount (USDT)</th>
                        <th class="tx-status">Status</th>
                        <th class="tx-date">Date</th>
                        <th>TxHash</th>
                        <th>Wallet</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </section>
    </div>

    <script>
        // Load general balance and transactions (no wallet-specific connection)
        const balanceEl = document.getElementById("availableBalance");
        const txTbody = document.querySelector("#recentTxn tbody");

        // Use a general 'balance' key (not tied to a wallet address)
        const balance = parseFloat(localStorage.getItem("balance")) || 0;
        const transactions = JSON.parse(localStorage.getItem("transactions") || "[]");

        balanceEl.innerText = `$${balance.toFixed(2)}`;

        // Load recent 5 transactions (properly aligned and with TxHash/Wallet columns)
        txTbody.innerHTML = "";
        if (transactions.length === 0) {
            const row = document.createElement("tr");
            row.innerHTML = `<td class="no-data" colspan="6">No transactions yet.</td>`;
            txTbody.appendChild(row);
        } else {
            transactions.slice(-5).reverse().forEach(tx => {
                const txHash = (tx.meta && tx.meta.txHash) ? tx.meta.txHash : "";
                const wallet = (tx.meta && tx.meta.wallet) ? tx.meta.wallet : "";
                const tr = document.createElement("tr");

                tr.innerHTML = `
          <td>${tx.type}</td>
          <td class="tx-amount">$${parseFloat(tx.amount).toFixed(2)}</td>
          <td class="tx-status">${tx.status}</td>
          <td class="tx-date">${new Date(tx.date).toLocaleString()}</td>
          <td class="tx-meta">${txHash}</td>
          <td class="tx-meta">${wallet}</td>
        `;
                txTbody.appendChild(tr);
            });
        }
    </script>


<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
import { getFirestore, doc, getDoc, collection, getDocs, addDoc, query, orderBy, updateDoc } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";

const firebaseConfig = {"apiKey": "AIzaSyBBj6aXHtdRqUyeSUazACqQbsZcTTVLP4U", "authDomain": "bobcat-65b3b.firebaseapp.com", "projectId": "bobcat-65b3b", "storageBucket": "bobcat-65b3b.firebasestorage.app", "messagingSenderId": "655074041293", "appId": "1:655074041293:web:39d5c2e5191941588cb884", "measurementId": "G-PX8EMZSDJY"};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const balanceEl = document.getElementById("availableBalance");
const txTbody = document.querySelector("#recentTxn tbody");

// Add UI for creating transaction and showing user info
const header = document.querySelector(".main-content header");
const userInfoP = document.createElement("p");
userInfoP.id = "userInfo";
header.appendChild(userInfoP);

// Create plan/transaction form area
const planCard = document.createElement("section");
planCard.className = "card";
planCard.innerHTML = `
  <h2>Add Transaction</h2>
  <form id="planForm">
    <input id="txType" placeholder="Type (Deposit/Withdraw)" required />
    <input id="txAmount" type="number" placeholder="Amount" required />
    <input id="txStatus" placeholder="Status (Success/Pending)" required />
    <button type="submit">Add Transaction</button>
  </form>
`;
document.querySelector(".main-content").insertBefore(planCard, document.querySelector(".main-content .card"));

// Utility to render transactions
function renderTransactions(transactions) {
  txTbody.innerHTML = "";
  if (!transactions || transactions.length === 0) {
    const row = document.createElement("tr");
    row.innerHTML = `<td class="no-data" colspan="6">No transactions yet.</td>`;
    txTbody.appendChild(row);
    return;
  }
  transactions.slice(0,5).forEach(tx => {
    const txHash = tx.txHash || "";
    const wallet = tx.wallet || "";
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${tx.type}</td>
      <td class="tx-amount">$${parseFloat(tx.amount).toFixed(2)}</td>
      <td class="tx-status">${tx.status}</td>
      <td class="tx-date">${new Date(tx.date).toLocaleString()}</td>
      <td class="tx-meta">${txHash}</td>
      <td class="tx-meta">${wallet}</td>
    `;
    txTbody.appendChild(tr);
  });
}

// Load user info and transactions
onAuthStateChanged(auth, async (user) => {
  if (user) {
    // fetch user doc
    const userRef = doc(db, "users", user.uid);
    const userSnap = await getDoc(userRef);
    if (userSnap.exists()) {
      const data = userSnap.data();
      userInfoP.innerHTML = `üëã Hello <b>${data.name}</b> <br><span class='small'>${data.email}</span>`;
      balanceEl.innerText = `$${(data.balance || 0).toFixed(2)}`;
    } else {
      userInfoP.innerText = "No user data";
      balanceEl.innerText = "$0.00";
    }

    // load transactions subcollection
    const txCol = collection(db, "users", user.uid, "transactions");
    const q = query(txCol, orderBy("date", "desc"));
    const txSnap = await getDocs(q);
    const txList = [];
    txSnap.forEach(d => txList.push(Object.assign({ id: d.id }, d.data())));
    renderTransactions(txList);

    // handle new transaction form
    const planForm = document.getElementById("planForm");
    planForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const type = document.getElementById("txType").value.trim();
      const amount = parseFloat(document.getElementById("txAmount").value);
      const status = document.getElementById("txStatus").value.trim();
      try {
        // add transaction doc
        await addDoc(collection(db, "users", user.uid, "transactions"), {
          type,
          amount,
          status,
          date: new Date().toISOString()
        });
        // update user balance (simple logic: deposit adds, withdraw subtracts)
        const userDocRef = doc(db, "users", user.uid);
        const currSnap = await getDoc(userDocRef);
        const curr = currSnap.exists() ? (currSnap.data().balance || 0) : 0;
        const newBal = status.toLowerCase().includes("success") ? (type.toLowerCase().includes("deposit") ? curr + amount : curr - amount) : curr;
        await updateDoc(userDocRef, { balance: newBal });
        alert("Transaction added");
        // reload to show updated transactions and balance
        const txSnap2 = await getDocs(query(txCol, orderBy("date", "desc")));
        const txList2 = []; txSnap2.forEach(d => txList2.push(Object.assign({ id: d.id }, d.data())));
        renderTransactions(txList2);
        balanceEl.innerText = `$${newBal.toFixed(2)}`;
        planForm.reset();
      } catch (err) {
        console.error(err);
        alert("Error: " + (err.message || err));
      }
    });

    // bind logout link/button
    const logoutLink = document.querySelector(".logout") || null;
    if (logoutLink) {
      logoutLink.addEventListener("click", async (ev) => {
        ev.preventDefault();
        await signOut(auth);
        window.location.href = "login.html";
      });
    }
  } else {
    // not logged in
    window.location.href = "login.html";
  }
});
</script>

</body>

</html>